578b07a12f0708248885e39627c08e1c
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filterConfig = filterConfig;
exports.findNodeHandle = findNodeHandle;
exports.scheduleFlushOperations = scheduleFlushOperations;
exports.baseGestureHandlerWithMonitorProps = exports.baseGestureHandlerProps = void 0;
var _reactNative = require("react-native");
var _handlersRegistry = require("./handlersRegistry");
var _utils = require("../utils");
var _RNGestureHandlerModule = _interopRequireDefault(require("../RNGestureHandlerModule"));
var _ghQueueMicrotask = require("../ghQueueMicrotask");
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
var commonProps = ['id', 'enabled', 'shouldCancelWhenOutside', 'hitSlop', 'cancelsTouchesInView', 'userSelect', 'activeCursor', 'mouseButton', 'enableContextMenu'];
var componentInteractionProps = ['waitFor', 'simultaneousHandlers', 'blocksHandlers'];
var baseGestureHandlerProps = [].concat(commonProps, componentInteractionProps, ['onBegan', 'onFailed', 'onCancelled', 'onActivated', 'onEnded', 'onGestureEvent', 'onHandlerStateChange']);
exports.baseGestureHandlerProps = baseGestureHandlerProps;
var baseGestureHandlerWithMonitorProps = [].concat(commonProps, ['needsPointerData', 'manualActivation']);
exports.baseGestureHandlerWithMonitorProps = baseGestureHandlerWithMonitorProps;
function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}
function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var filteredConfig = Object.assign({}, defaults);
  for (var key of validProps) {
    var value = props[key];
    if (isConfigParam(value, key)) {
      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop' && typeof value !== 'object') {
        value = {
          top: value,
          left: value,
          bottom: value,
          right: value
        };
      }
      filteredConfig[key] = value;
    }
  }
  return filteredConfig;
}
function transformIntoHandlerTags(handlerIDs) {
  handlerIDs = (0, _utils.toArray)(handlerIDs);
  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }
  return handlerIDs.map(function (handlerID) {
    var _handlerID$current;
    return _handlersRegistry.handlerIDToTag[handlerID] || ((_handlerID$current = handlerID.current) === null || _handlerID$current === void 0 ? void 0 : _handlerID$current.handlerTag) || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}
function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') {
    return node;
  }
  return (0, _reactNative.findNodeHandle)(node);
}
var flushOperationsScheduled = false;
function scheduleFlushOperations() {
  if (!flushOperationsScheduled) {
    flushOperationsScheduled = true;
    (0, _ghQueueMicrotask.ghQueueMicrotask)(function () {
      _RNGestureHandlerModule.default.flushOperations();
      flushOperationsScheduled = false;
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3ROYXRpdmUiLCJyZXF1aXJlIiwiX2hhbmRsZXJzUmVnaXN0cnkiLCJfdXRpbHMiLCJfUk5HZXN0dXJlSGFuZGxlck1vZHVsZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfZ2hRdWV1ZU1pY3JvdGFzayIsImNvbW1vblByb3BzIiwiY29tcG9uZW50SW50ZXJhY3Rpb25Qcm9wcyIsImJhc2VHZXN0dXJlSGFuZGxlclByb3BzIiwiY29uY2F0IiwiYmFzZUdlc3R1cmVIYW5kbGVyV2l0aE1vbml0b3JQcm9wcyIsImlzQ29uZmlnUGFyYW0iLCJwYXJhbSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJmaWx0ZXJDb25maWciLCJwcm9wcyIsInZhbGlkUHJvcHMiLCJkZWZhdWx0cyIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZpbHRlcmVkQ29uZmlnIiwiYXNzaWduIiwia2V5IiwidmFsdWUiLCJ0cmFuc2Zvcm1JbnRvSGFuZGxlclRhZ3MiLCJ0b3AiLCJsZWZ0IiwiYm90dG9tIiwicmlnaHQiLCJoYW5kbGVySURzIiwidG9BcnJheSIsIlBsYXRmb3JtIiwiT1MiLCJtYXAiLCJfcmVmIiwiY3VycmVudCIsImZpbHRlciIsImhhbmRsZSIsImhhbmRsZXJJRCIsIl9oYW5kbGVySUQkY3VycmVudCIsImhhbmRsZXJJRFRvVGFnIiwiaGFuZGxlclRhZyIsImZpbmROb2RlSGFuZGxlIiwibm9kZSIsImZsdXNoT3BlcmF0aW9uc1NjaGVkdWxlZCIsInNjaGVkdWxlRmx1c2hPcGVyYXRpb25zIiwiZ2hRdWV1ZU1pY3JvdGFzayIsImRlZmF1bHQiLCJmbHVzaE9wZXJhdGlvbnMiXSwic291cmNlcyI6WyJnZXN0dXJlSGFuZGxlckNvbW1vbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQcmV2aW91cyB0eXBlcyBleHBvcnRlZCBnZXN0dXJlIGhhbmRsZXJzIGFzIGNsYXNzZXMgd2hpY2ggY3JlYXRlcyBhbiBpbnRlcmZhY2UgYW5kIHZhcmlhYmxlLCBib3RoIG5hbWVkIHRoZSBzYW1lIGFzIGNsYXNzLlxuLy8gV2l0aG91dCB0aG9zZSB0eXBlcywgd2UnZCBpbnRyb2R1Y2UgYnJlYWtpbmcgY2hhbmdlLCBmb3JjaW5nIHVzZXJzIHRvIHByZWZpeCBldmVyeSBoYW5kbGVyIHR5cGUgc3BlY2lmaWNhdGlvbiB3aXRoIHR5cGVvZlxuLy8gZS5nLiBSZWFjdC5jcmVhdGVSZWY8VGFwR2VzdHVyZUhhbmRsZXI+IC0+IFJlYWN0LmNyZWF0ZVJlZjx0eXBlb2YgVGFwR2VzdHVyZUhhbmRsZXI+LlxuLy8gU2VlIGh0dHBzOi8vd3d3LnR5cGVzY3JpcHRsYW5nLm9yZy9kb2NzL2hhbmRib29rL2NsYXNzZXMuaHRtbCNjb25zdHJ1Y3Rvci1mdW5jdGlvbnMgZm9yIHJlZmVyZW5jZS5cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFBsYXRmb3JtLCBmaW5kTm9kZUhhbmRsZSBhcyBmaW5kTm9kZUhhbmRsZVJOIH0gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi9TdGF0ZSc7XG5pbXBvcnQgeyBUb3VjaEV2ZW50VHlwZSB9IGZyb20gJy4uL1RvdWNoRXZlbnRUeXBlJztcbmltcG9ydCB7IFZhbHVlT2YgfSBmcm9tICcuLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgaGFuZGxlcklEVG9UYWcgfSBmcm9tICcuL2hhbmRsZXJzUmVnaXN0cnknO1xuaW1wb3J0IHsgdG9BcnJheSB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlIGZyb20gJy4uL1JOR2VzdHVyZUhhbmRsZXJNb2R1bGUnO1xuaW1wb3J0IHsgZ2hRdWV1ZU1pY3JvdGFzayB9IGZyb20gJy4uL2doUXVldWVNaWNyb3Rhc2snO1xuaW1wb3J0IHsgTW91c2VCdXR0b24gfSBmcm9tICcuLi93ZWIvaW50ZXJmYWNlcyc7XG5cbmNvbnN0IGNvbW1vblByb3BzID0gW1xuICAnaWQnLFxuICAnZW5hYmxlZCcsXG4gICdzaG91bGRDYW5jZWxXaGVuT3V0c2lkZScsXG4gICdoaXRTbG9wJyxcbiAgJ2NhbmNlbHNUb3VjaGVzSW5WaWV3JyxcbiAgJ3VzZXJTZWxlY3QnLFxuICAnYWN0aXZlQ3Vyc29yJyxcbiAgJ21vdXNlQnV0dG9uJyxcbiAgJ2VuYWJsZUNvbnRleHRNZW51Jyxcbl0gYXMgY29uc3Q7XG5cbmNvbnN0IGNvbXBvbmVudEludGVyYWN0aW9uUHJvcHMgPSBbXG4gICd3YWl0Rm9yJyxcbiAgJ3NpbXVsdGFuZW91c0hhbmRsZXJzJyxcbiAgJ2Jsb2Nrc0hhbmRsZXJzJyxcbl0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBiYXNlR2VzdHVyZUhhbmRsZXJQcm9wcyA9IFtcbiAgLi4uY29tbW9uUHJvcHMsXG4gIC4uLmNvbXBvbmVudEludGVyYWN0aW9uUHJvcHMsXG4gICdvbkJlZ2FuJyxcbiAgJ29uRmFpbGVkJyxcbiAgJ29uQ2FuY2VsbGVkJyxcbiAgJ29uQWN0aXZhdGVkJyxcbiAgJ29uRW5kZWQnLFxuICAnb25HZXN0dXJlRXZlbnQnLFxuICAnb25IYW5kbGVyU3RhdGVDaGFuZ2UnLFxuXSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IGJhc2VHZXN0dXJlSGFuZGxlcldpdGhNb25pdG9yUHJvcHMgPSBbXG4gIC4uLmNvbW1vblByb3BzLFxuICAnbmVlZHNQb2ludGVyRGF0YScsXG4gICdtYW51YWxBY3RpdmF0aW9uJyxcbl07XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VzdHVyZUV2ZW50UGF5bG9hZCB7XG4gIGhhbmRsZXJUYWc6IG51bWJlcjtcbiAgbnVtYmVyT2ZQb2ludGVyczogbnVtYmVyO1xuICBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+O1xufVxuZXhwb3J0IGludGVyZmFjZSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgZXh0ZW5kcyBHZXN0dXJlRXZlbnRQYXlsb2FkIHtcbiAgb2xkU3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbn1cblxuZXhwb3J0IHR5cGUgSGl0U2xvcCA9XG4gIHwgbnVtYmVyXG4gIHwgUGFydGlhbDxcbiAgICAgIFJlY29yZDxcbiAgICAgICAgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnLFxuICAgICAgICBudW1iZXJcbiAgICAgID5cbiAgICA+XG4gIHwgUmVjb3JkPCd3aWR0aCcgfCAnbGVmdCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J3dpZHRoJyB8ICdyaWdodCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J2hlaWdodCcgfCAndG9wJywgbnVtYmVyPlxuICB8IFJlY29yZDwnaGVpZ2h0JyB8ICdib3R0b20nLCBudW1iZXI+O1xuXG5leHBvcnQgdHlwZSBVc2VyU2VsZWN0ID0gJ25vbmUnIHwgJ2F1dG8nIHwgJ3RleHQnO1xuZXhwb3J0IHR5cGUgQWN0aXZlQ3Vyc29yID1cbiAgfCAnYXV0bydcbiAgfCAnZGVmYXVsdCdcbiAgfCAnbm9uZSdcbiAgfCAnY29udGV4dC1tZW51J1xuICB8ICdoZWxwJ1xuICB8ICdwb2ludGVyJ1xuICB8ICdwcm9ncmVzcydcbiAgfCAnd2FpdCdcbiAgfCAnY2VsbCdcbiAgfCAnY3Jvc3NoYWlyJ1xuICB8ICd0ZXh0J1xuICB8ICd2ZXJ0aWNhbC10ZXh0J1xuICB8ICdhbGlhcydcbiAgfCAnY29weSdcbiAgfCAnbW92ZSdcbiAgfCAnbm8tZHJvcCdcbiAgfCAnbm90LWFsbG93ZWQnXG4gIHwgJ2dyYWInXG4gIHwgJ2dyYWJiaW5nJ1xuICB8ICdlLXJlc2l6ZSdcbiAgfCAnbi1yZXNpemUnXG4gIHwgJ25lLXJlc2l6ZSdcbiAgfCAnbnctcmVzaXplJ1xuICB8ICdzLXJlc2l6ZSdcbiAgfCAnc2UtcmVzaXplJ1xuICB8ICdzdy1yZXNpemUnXG4gIHwgJ3ctcmVzaXplJ1xuICB8ICdldy1yZXNpemUnXG4gIHwgJ25zLXJlc2l6ZSdcbiAgfCAnbmVzdy1yZXNpemUnXG4gIHwgJ253c2UtcmVzaXplJ1xuICB8ICdjb2wtcmVzaXplJ1xuICB8ICdyb3ctcmVzaXplJ1xuICB8ICdhbGwtc2Nyb2xsJ1xuICB8ICd6b29tLWluJ1xuICB8ICd6b29tLW91dCc7XG5cbi8vVE9ETyhUUykgZXZlbnRzIGluIGhhbmRsZXJzXG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VzdHVyZUV2ZW50PEV4dHJhRXZlbnRQYXlsb2FkVCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gIG5hdGl2ZUV2ZW50OiBSZWFkb25seTxHZXN0dXJlRXZlbnRQYXlsb2FkICYgRXh0cmFFdmVudFBheWxvYWRUPjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQ8XG4gIEV4dHJhRXZlbnRQYXlsb2FkVCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+IHtcbiAgbmF0aXZlRXZlbnQ6IFJlYWRvbmx5PEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50UGF5bG9hZCAmIEV4dHJhRXZlbnRQYXlsb2FkVD47XG59XG5cbmV4cG9ydCB0eXBlIFRvdWNoRGF0YSA9IHtcbiAgaWQ6IG51bWJlcjtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG4gIGFic29sdXRlWDogbnVtYmVyO1xuICBhYnNvbHV0ZVk6IG51bWJlcjtcbn07XG5cbmV4cG9ydCB0eXBlIEdlc3R1cmVUb3VjaEV2ZW50ID0ge1xuICBoYW5kbGVyVGFnOiBudW1iZXI7XG4gIG51bWJlck9mVG91Y2hlczogbnVtYmVyO1xuICBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+O1xuICBldmVudFR5cGU6IFRvdWNoRXZlbnRUeXBlO1xuICBhbGxUb3VjaGVzOiBUb3VjaERhdGFbXTtcbiAgY2hhbmdlZFRvdWNoZXM6IFRvdWNoRGF0YVtdO1xufTtcblxuZXhwb3J0IHR5cGUgR2VzdHVyZVVwZGF0ZUV2ZW50PEdlc3R1cmVFdmVudFBheWxvYWRUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID1cbiAgR2VzdHVyZUV2ZW50UGF5bG9hZCAmIEdlc3R1cmVFdmVudFBheWxvYWRUO1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudDxcbiAgR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnRQYXlsb2FkVCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+ID0gSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnRQYXlsb2FkICYgR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnRQYXlsb2FkVDtcblxuZXhwb3J0IHR5cGUgQ29tbW9uR2VzdHVyZUNvbmZpZyA9IHtcbiAgZW5hYmxlZD86IGJvb2xlYW47XG4gIHNob3VsZENhbmNlbFdoZW5PdXRzaWRlPzogYm9vbGVhbjtcbiAgaGl0U2xvcD86IEhpdFNsb3A7XG4gIHVzZXJTZWxlY3Q/OiBVc2VyU2VsZWN0O1xuICBhY3RpdmVDdXJzb3I/OiBBY3RpdmVDdXJzb3I7XG4gIG1vdXNlQnV0dG9uPzogTW91c2VCdXR0b247XG4gIGVuYWJsZUNvbnRleHRNZW51PzogYm9vbGVhbjtcbn07XG5cbi8vIEV2ZW50cyBwYXlsb2FkcyBhcmUgdHlwZXMgaW5zdGVhZCBvZiBpbnRlcmZhY2VzIGR1ZSB0byBUUyBsaW1pdGF0aW9uLlxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTUzMDAgZm9yIG1vcmUgaW5mby5cbmV4cG9ydCB0eXBlIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+ID0gQ29tbW9uR2VzdHVyZUNvbmZpZyAmIHtcbiAgaWQ/OiBzdHJpbmc7XG4gIHdhaXRGb3I/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgc2ltdWx0YW5lb3VzSGFuZGxlcnM/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgYmxvY2tzSGFuZGxlcnM/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgdGVzdElEPzogc3RyaW5nO1xuICBjYW5jZWxzVG91Y2hlc0luVmlldz86IGJvb2xlYW47XG4gIC8vIFRPRE8oVFMpIC0gZml4IGV2ZW50IHR5cGVzXG4gIG9uQmVnYW4/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkZhaWxlZD86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG4gIG9uQ2FuY2VsbGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcbiAgb25BY3RpdmF0ZWQ/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkVuZGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcblxuICAvL1RPRE8oVFMpIGNvbnNpZGVyIHVzaW5nIE5hdGl2ZVN5bnRoZXRpY0V2ZW50XG4gIG9uR2VzdHVyZUV2ZW50PzogKGV2ZW50OiBHZXN0dXJlRXZlbnQ8RXh0cmFFdmVudFBheWxvYWRUPikgPT4gdm9pZDtcbiAgb25IYW5kbGVyU3RhdGVDaGFuZ2U/OiAoXG4gICAgZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PEV4dHJhRXZlbnRQYXlsb2FkVD5cbiAgKSA9PiB2b2lkO1xuICAvLyBpbXBsaWNpdCBgY2hpbGRyZW5gIHByb3AgaGFzIGJlZW4gcmVtb3ZlZCBpbiBAdHlwZXMvcmVhY3ReMTguMC4wXG4gIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xufTtcblxuZnVuY3Rpb24gaXNDb25maWdQYXJhbShwYXJhbTogdW5rbm93biwgbmFtZTogc3RyaW5nKSB7XG4gIC8vIHBhcmFtICE9PSBPYmplY3QocGFyYW0pIHJldHVybnMgZmFsc2UgaWYgYHBhcmFtYCBpcyBhIGZ1bmN0aW9uXG4gIC8vIG9yIGFuIG9iamVjdCBhbmQgcmV0dXJucyB0cnVlIGlmIGBwYXJhbWAgaXMgbnVsbFxuICByZXR1cm4gKFxuICAgIHBhcmFtICE9PSB1bmRlZmluZWQgJiZcbiAgICAocGFyYW0gIT09IE9iamVjdChwYXJhbSkgfHxcbiAgICAgICEoJ19faXNOYXRpdmUnIGluIChwYXJhbSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikpKSAmJlxuICAgIG5hbWUgIT09ICdvbkhhbmRsZXJTdGF0ZUNoYW5nZScgJiZcbiAgICBuYW1lICE9PSAnb25HZXN0dXJlRXZlbnQnXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJDb25maWcoXG4gIHByb3BzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgdmFsaWRQcm9wczogc3RyaW5nW10sXG4gIGRlZmF1bHRzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4pIHtcbiAgY29uc3QgZmlsdGVyZWRDb25maWcgPSB7IC4uLmRlZmF1bHRzIH07XG4gIGZvciAoY29uc3Qga2V5IG9mIHZhbGlkUHJvcHMpIHtcbiAgICBsZXQgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGlmIChpc0NvbmZpZ1BhcmFtKHZhbHVlLCBrZXkpKSB7XG4gICAgICBpZiAoa2V5ID09PSAnc2ltdWx0YW5lb3VzSGFuZGxlcnMnIHx8IGtleSA9PT0gJ3dhaXRGb3InKSB7XG4gICAgICAgIHZhbHVlID0gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKHByb3BzW2tleV0pO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdoaXRTbG9wJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHZhbHVlID0geyB0b3A6IHZhbHVlLCBsZWZ0OiB2YWx1ZSwgYm90dG9tOiB2YWx1ZSwgcmlnaHQ6IHZhbHVlIH07XG4gICAgICB9XG4gICAgICBmaWx0ZXJlZENvbmZpZ1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmaWx0ZXJlZENvbmZpZztcbn1cblxuZnVuY3Rpb24gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKGhhbmRsZXJJRHM6IGFueSkge1xuICBoYW5kbGVySURzID0gdG9BcnJheShoYW5kbGVySURzKTtcblxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICd3ZWInKSB7XG4gICAgcmV0dXJuIGhhbmRsZXJJRHNcbiAgICAgIC5tYXAoKHsgY3VycmVudCB9OiB7IGN1cnJlbnQ6IGFueSB9KSA9PiBjdXJyZW50KVxuICAgICAgLmZpbHRlcigoaGFuZGxlOiBhbnkpID0+IGhhbmRsZSk7XG4gIH1cbiAgLy8gY29udmVydHMgaGFuZGxlciBzdHJpbmcgSURzIGludG8gdGhlaXIgbnVtZXJpYyB0YWdzXG4gIHJldHVybiBoYW5kbGVySURzXG4gICAgLm1hcChcbiAgICAgIChoYW5kbGVySUQ6IGFueSkgPT5cbiAgICAgICAgaGFuZGxlcklEVG9UYWdbaGFuZGxlcklEXSB8fCBoYW5kbGVySUQuY3VycmVudD8uaGFuZGxlclRhZyB8fCAtMVxuICAgIClcbiAgICAuZmlsdGVyKChoYW5kbGVyVGFnOiBudW1iZXIpID0+IGhhbmRsZXJUYWcgPiAwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmROb2RlSGFuZGxlKFxuICBub2RlOiBudWxsIHwgbnVtYmVyIHwgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiB8IFJlYWN0LkNvbXBvbmVudENsYXNzPGFueT5cbik6IG51bGwgfCBudW1iZXIgfCBSZWFjdC5Db21wb25lbnQ8YW55LCBhbnk+IHwgUmVhY3QuQ29tcG9uZW50Q2xhc3M8YW55PiB7XG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuICByZXR1cm4gZmluZE5vZGVIYW5kbGVSTihub2RlKTtcbn1cblxubGV0IGZsdXNoT3BlcmF0aW9uc1NjaGVkdWxlZCA9IGZhbHNlO1xuXG5leHBvcnQgZnVuY3Rpb24gc2NoZWR1bGVGbHVzaE9wZXJhdGlvbnMoKSB7XG4gIGlmICghZmx1c2hPcGVyYXRpb25zU2NoZWR1bGVkKSB7XG4gICAgZmx1c2hPcGVyYXRpb25zU2NoZWR1bGVkID0gdHJ1ZTtcbiAgICBnaFF1ZXVlTWljcm90YXNrKCgpID0+IHtcbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuZmx1c2hPcGVyYXRpb25zKCk7XG5cbiAgICAgIGZsdXNoT3BlcmF0aW9uc1NjaGVkdWxlZCA9IGZhbHNlO1xuICAgIH0pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUtBLElBQUFBLFlBQUEsR0FBQUMsT0FBQTtBQUtBLElBQUFDLGlCQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxNQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyx1QkFBQSxHQUFBQyxzQkFBQSxDQUFBSixPQUFBO0FBQ0EsSUFBQUssaUJBQUEsR0FBQUwsT0FBQTs7Ozs7O0FBR0EsSUFBTU0sV0FBVyxHQUFHLENBQ2xCLElBRGtCLEVBRWxCLFNBRmtCLEVBR2xCLHlCQUhrQixFQUlsQixTQUprQixFQUtsQixzQkFMa0IsRUFNbEIsWUFOa0IsRUFPbEIsY0FQa0IsRUFRbEIsYUFSa0IsRUFTbEIsbUJBVGtCLENBQXBCO0FBWUEsSUFBTUMseUJBQXlCLEdBQUcsQ0FDaEMsU0FEZ0MsRUFFaEMsc0JBRmdDLEVBR2hDLGdCQUhnQyxDQUFsQztBQU1PLElBQU1DLHVCQUF1QixNQUFBQyxNQUFBLENBQy9CSCxXQURrQyxFQUVsQ0MseUJBRmtDLEdBR3JDLFNBSHFDLEVBSXJDLFVBSnFDLEVBS3JDLGFBTHFDLEVBTXJDLGFBTnFDLEVBT3JDLFNBUHFDLEVBUXJDLGdCQVJxQyxFQVNyQyxzQkFUcUMsRUFBaEM7O0FBWUEsSUFBTUcsa0NBQWtDLE1BQUFELE1BQUEsQ0FDMUNILFdBRDZDLEdBRWhELGtCQUZnRCxFQUdoRCxrQkFIZ0QsRUFBM0M7O0FBMklQLFNBQVNLLGFBQVRBLENBQXVCQyxLQUF2QixFQUF1Q0MsSUFBdkMsRUFBcUQ7RUFHbkQsT0FDRUQsS0FBSyxLQUFLRSxTQUFWLEtBQ0NGLEtBQUssS0FBS0csTUFBTSxDQUFDSCxLQUFELENBQWhCLElBQ0MsRUFBRSxnQkFBaUJBLEtBQW5CLENBRkYsS0FHQUMsSUFB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